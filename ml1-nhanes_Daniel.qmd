---
title: "ML1 Analysis Daniel"
format: html
---

```{r}
#| label: "libraries"
#| message: false

library(tidyverse)
library(NHANES)

```

## Data: NHANES (National Health and Nutrition Examination Survey)

We checked three different data sets:

-   ISLR, Introduction to Statistical Learning (book/package): `wages`

-   National Health and Nutrition Examination Survey: `nhanes`

-   UCI University of California, Irvine, Machine Learning Repository: `AdultUCI`

All three data sets meet the requirements for the project. Given the different analyses we will be conducting in the project, we opted for the data set with the **broadest range of variables**.

And: The topic of health also immediately **appealed to us**.

Selecting a few variables makes handling easier.

```{r}
#| label: "nhanes dataset"
#| include: false

data(NHANES)
# str(NHANES)

# Subset with ~20 variables (all types included)
nhanes_sub <- NHANES %>%
  select(
    # demographie
    SurveyYr, Gender, Age, AgeDecade, Race1, Education, MaritalStatus,
    HHIncome, HHIncomeMid, Poverty, HomeRooms, HomeOwn,
    
    # health (continuous + categorical)
    Height, Weight, BMI, HealthGen,
    Pulse, BPSysAve, BPDiaAve,
    
    # behaviour & life style
    PhysActive, PhysActiveDays, SleepHrsNight, SleepTrouble,
    Alcohol12PlusYr, AlcoholDay, AlcoholYear,
    SmokeNow, Smoke100, SmokeAge,
    
    # mental health
    DaysPhysHlthBad, DaysMentHlthBad,
    LittleInterest, Depressed
  )

str(nhanes_sub)

```

### Types of variables in the nhanes dataset: (i.e. nhanes_sub)

| Variable | Type | Description / Example |
|-----------------|-----------------|---------------------------------------|
| **SurveyYr** | categorical | Survey year (`2009_10`, `2011_12`) |
| **Gender** | binary | Gender (`male`, `female`) |
| **Age** | count | Age in years (0–80, integers) |
| **AgeDecade** | categorical | Age in decades (`20-29`, `30-39`, …) |
| **Race1** | categorical | Ethnicity (`Black`, `White`, `Mexican`, `Hispanic`, `Other`) |
| **Education** | categorical | Education level (`8th Grade`, `Some College`, …) |
| **MaritalStatus** | categorical | Marital status (`Married`, `Divorced`, `Widowed`, …) |
| **HHIncome** | categorical | Household income class (`0–4999`, `50–74k`, …) |
| **HHIncomeMid** | continuous | Median household income (numeric, in \$) |
| **Poverty** | continuous | Poverty index (income-to-poverty ratio) |
| **HomeRooms** | count | Number of rooms in the household |
| **HomeOwn** | categorical | Home ownership (`Own`, `Rent`, `Other`) |
| **Height** | continuous | Height in cm |
| **Weight** | continuous | Weight in kg |
| **BMI** | continuous | Body Mass Index |
| **HealthGen** | categorical | Self-rated health (`Excellent`, `Fair`, …) |
| **Pulse** | continuous | Resting heart rate (beats per minute) |
| **BPSysAve** | continuous | Average systolic blood pressure |
| **BPDiaAve** | continuous | Average diastolic blood pressure |
| **PhysActive** | binary | Physically active (`Yes`/`No`) |
| **PhysActiveDays** | count | Number of physically active days per week (0–7) |
| **SleepHrsNight** | count | Hours of sleep per night |
| **SleepTrouble** | binary | Trouble sleeping (`Yes`/`No`) |
| **Alcohol12PlusYr** | binary | Ever drank alcohol (≥12 drinks per year, `Yes`/`No`) |
| **AlcoholDay** | count | Number of alcoholic drinks per day |
| **AlcoholYear** | count | Number of alcoholic drinks per year |
| **SmokeNow** | binary | Currently smokes (`Yes`/`No`) |
| **Smoke100** | binary | Ever smoked ≥100 cigarettes (`Yes`/`No`) |
| **SmokeAge** | count | Age at smoking initiation |
| **DaysPhysHlthBad** | count | Days with poor physical health (0–30) |
| **DaysMentHlthBad** | count | Days with poor mental health (0–30) |
| **LittleInterest** | binary | Little interest in activities (`Yes`/`No`) |
| **Depressed** | categorical | Times feeling depressed (None, Most, Several, NAs) |

## Generalised Linear Model (family: Binomial)

### Make outcome variable Depressed (three levels) binary

```{r}
#| label: "Depressed binomial"

summary(nhanes_sub$Depressed)

nhanes_sub <- nhanes_sub %>%
  mutate(
    Depressed_bin = case_when(
      Depressed == "None" ~ "no",
      Depressed %in% c("Several", "Most") ~ "yes",
      TRUE ~ NA_character_
    ),
    Depressed_bin = factor(Depressed_bin, levels = c("no", "yes"))
  )

# Check the recode
table(nhanes_sub$Depressed, nhanes_sub$Depressed_bin, useNA = "ifany")

```

### Visual inspection of Variable Depressed_bin

```{r}
#| label: "Depressed_bin Visuals"

# Age vs Depressed
ggplot(filter(nhanes_sub, !is.na(Depressed_bin)), aes(x = Depressed_bin, y = Age)) +
  geom_boxplot()

# SleepHrsNight vs Depressed
ggplot(filter(nhanes_sub, !is.na(Depressed_bin)), aes(x = Depressed_bin, y = SleepHrsNight)) +
  geom_boxplot()

# Gender vs Depressed
ggplot(filter(nhanes_sub, !is.na(Depressed_bin)), aes(x = Gender, fill = Depressed_bin)) +
  geom_bar(position = "fill")

# PhysActive vs Depressed
ggplot(filter(nhanes_sub, !is.na(Depressed_bin)), aes(x = PhysActive, fill = Depressed_bin)) +
  geom_bar(position = "fill")

# MaritalStatus vs Depressed
ggplot(filter(nhanes_sub, !is.na(Depressed_bin)), aes(x = MaritalStatus, fill = Depressed_bin)) +
  geom_bar(position = "fill") +
  theme(axis.text.x = element_text(angle=45, hjust=1))

```

### Create the models

```{r}
#| label: "GLM Binomial"

glm_depressed <- glm(Depressed_bin ~ Age + Gender + SleepHrsNight + PhysActive +
                   MaritalStatus, data = nhanes_sub,
                 family = binomial)
summary(glm_depressed)

```
